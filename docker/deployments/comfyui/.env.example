# ============================================================================
# ComfyUI Environment Configuration
# ============================================================================
# Copy this file to .env and customize the values for your deployment
# IMPORTANT: Never commit .env to version control!

# ============================================================================
# Project Settings
# ============================================================================

# Project name (used for container naming, network naming, etc.)
# Default: comfyui
# This prevents conflicts with other Docker Compose projects (e.g., owui)
PROJECT_NAME=comfyui

# Domain for HTTPS access and certificate generation
# Examples:
#   - localhost (local development)
#   - your-device.ts.net (Tailscale)
#   - comfyui.yourdomain.com (public domain)
DOMAIN=localhost

# ============================================================================
# Caddy Reverse Proxy
# ============================================================================

# Caddy version
CADDY_VERSION=2-alpine

# HTTPS port (exposed on host)
# Default: 8444 (different from owui's 8443 to avoid conflicts)
CADDY_HTTPS_PORT=8444

# Caddy resource limits
CADDY_MEMORY_LIMIT=512m
CADDY_MEMORY_RESERVATION=128m
CADDY_CPU_LIMIT=0.5

# Caddy logs directory
CADDY_LOGS_PATH=./logs/caddy

# Caddy data directory (ACME certificates storage)
CADDY_DATA_PATH=./volumes/caddy-data

# Caddy config storage directory
CADDY_CONFIG_PATH=./volumes/caddy-config

# Use Tailscale certificates (recommended for Tailscale networks)
# Set to "true" if you're using Tailscale, "false" for self-signed/Let's Encrypt
USE_TAILSCALE_CERTS=true

# Enable Let's Encrypt automatic certificate management
# Set to true to use ACME instead of manual certificates
USE_LETSENCRYPT=false

# Email address for Let's Encrypt certificate registration and renewal notifications
ACME_EMAIL=

# ============================================================================
# ComfyUI Settings
# ============================================================================

# ComfyUI Docker image
# After building on DGX Spark, this will be: comfyui:latest-arm64
# Built on NVIDIA PyTorch 25.10 (PyTorch 2.9, CUDA 13.0.2, Python 3.12)
COMFYUI_IMAGE=comfyui:latest-arm64

# ComfyUI internal port (do not change unless you know what you're doing)
COMFYUI_PORT=8188

# ============================================================================
# GPU Configuration
# ============================================================================
# Note: Requires NVIDIA GPU with CUDA 13.0+ support
# Image built on NVIDIA PyTorch 25.10 (CUDA 13.0.2)

# GPU device IDs to use (comma-separated for multiple GPUs)
# Examples:
#   - 0 (single GPU, device 0)
#   - 0,1 (multiple GPUs)
#   - all (all available GPUs)
# Note: Shared with owui/vLLM if running concurrently
GPU_DEVICE_IDS=0

# ============================================================================
# Resource Limits
# ============================================================================

# ComfyUI CPU limits
COMFYUI_CPU_LIMIT=8
COMFYUI_CPU_RESERVATION=2

# ComfyUI memory limits
COMFYUI_MEMORY_LIMIT=32G
COMFYUI_MEMORY_RESERVATION=4G

# ============================================================================
# Network Configuration
# ============================================================================

# Network name for Docker Compose
NETWORK_NAME=comfyui-network

# Network subnet (must not conflict with owui's 172.29.0.0/16)
NETWORK_SUBNET=172.30.0.0/16

# ============================================================================
# Watchtower (Automatic Updates)
# ============================================================================

# Update schedule (cron format: second minute hour day month weekday)
# Default: 0 0 4 * * * (daily at 4 AM UTC)
# Examples:
#   - 0 0 4 * * * (daily at 4 AM)
#   - 0 0 4 * * 0 (weekly on Sunday at 4 AM)
#   - 0 0 4 1 * * (monthly on the 1st at 4 AM)
WATCHTOWER_SCHEDULE='0 0 4 * * *'

# Timeout for stopping containers before update (in seconds)
WATCHTOWER_TIMEOUT=300s

# ============================================================================
# Backup Settings
# ============================================================================

# Enable GPG encryption for backups (recommended for production)
BACKUP_ENABLE_ENCRYPTION=false

# GPG recipient for encrypted backups (email or key ID)
# Required if BACKUP_ENABLE_ENCRYPTION=true
BACKUP_GPG_RECIPIENT=

# Backup compression algorithm
# Options: gzip, bzip2, xz
# gzip: fast, moderate compression
# bzip2: slower, better compression
# xz: slowest, best compression
BACKUP_COMPRESSION=gzip

# Backup retention (days)
# Automatically delete backups older than this
BACKUP_RETENTION_DAYS=30

# ============================================================================
# Logging
# ============================================================================

# Log driver for Docker containers
# Options: json-file, syslog, journald, etc.
LOG_DRIVER=json-file

# Maximum log file size
LOG_MAX_SIZE=100m

# Maximum number of log files to keep
LOG_MAX_FILE=5

# ============================================================================
# Timezone
# ============================================================================

# Timezone for containers and logs
# Examples: UTC, America/New_York, Europe/London, Asia/Tokyo
TZ=UTC+1

# ============================================================================
# Health Check Configuration
# ============================================================================

# Health check intervals and timeouts
HEALTHCHECK_INTERVAL=30s
HEALTHCHECK_TIMEOUT=10s
HEALTHCHECK_RETRIES=3
HEALTHCHECK_START_PERIOD_CADDY=10s

# ============================================================================
# Performance Tuning (Advanced)
# ============================================================================

# PyTorch settings (uncomment to enable)
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
CUDA_VISIBLE_DEVICES=0

# ComfyUI preview method
# Options: auto, latent2rgb, taesd
COMFYUI_PREVIEW_METHOD=auto
