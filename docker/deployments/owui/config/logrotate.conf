# ============================================================================
# Logrotate Configuration for OpenWebUI
# ============================================================================
#
# This configuration rotates application logs in the volumes/logs directory.
# Docker container logs are already managed by Docker's logging driver.
#
# INSTALLATION:
#   1. Copy this file to /etc/logrotate.d/openwebui (requires root)
#   2. Or use the automated script: ./scripts/setup-logrotate.sh
#
# MANUAL SETUP:
#   sudo cp config/logrotate.conf /etc/logrotate.d/openwebui
#   sudo chmod 644 /etc/logrotate.d/openwebui
#
# TEST:
#   sudo logrotate -d /etc/logrotate.d/openwebui
#
# FORCE ROTATION (for testing):
#   sudo logrotate -f /etc/logrotate.d/openwebui
#
# ============================================================================

# OpenWebUI application logs
/home/emaballarin/repositories/sparksjoy/docker/owui/logs/openwebui/*.log {
    # Rotate daily
    daily

    # Keep 7 days of logs
    rotate 7

    # Don't error if log file is missing
    missingok

    # Don't rotate if log file is empty
    notifempty

    # Compress rotated logs (saves disk space)
    compress

    # Delay compression until next rotation (allows log analysis)
    delaycompress

    # Create new log file with same permissions
    create 0644 root root

    # Use date as suffix instead of number
    dateext
    dateformat -%Y%m%d

    # Actions after rotation
    postrotate
        # Signal applications to reopen log files if needed
        # (OpenWebUI typically handles this automatically)
    endscript
}

# Traefik logs
/home/emaballarin/repositories/sparksjoy/docker/owui/logs/traefik/*.log {
    # Rotate daily
    daily

    # Keep 7 days of logs
    rotate 7

    # Don't error if log file is missing
    missingok

    # Don't rotate if log file is empty
    notifempty

    # Compress rotated logs
    compress

    # Delay compression until next rotation
    delaycompress

    # Create new log file with same permissions
    create 0644 root root

    # Use date as suffix
    dateext
    dateformat -%Y%m%d

    # Actions after rotation
    postrotate
        # Traefik handles log file reopening automatically
    endscript
}

# Alternative: Weekly rotation with longer retention
# Uncomment the sections below and comment out the daily sections above

# /home/emaballarin/repositories/sparksjoy/docker/owui/logs/openwebui/*.log {
#     weekly
#     rotate 4
#     missingok
#     notifempty
#     compress
#     delaycompress
#     create 0644 root root
#     dateext
# }

# /home/emaballarin/repositories/sparksjoy/docker/owui/logs/traefik/*.log {
#     weekly
#     rotate 4
#     missingok
#     notifempty
#     compress
#     delaycompress
#     create 0644 root root
#     dateext
# }
